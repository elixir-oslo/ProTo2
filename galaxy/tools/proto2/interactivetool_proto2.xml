<tool id="interactive_tool_proto2" tool_type="interactive" name="Interactive ProTo service" version="0.0.1">
    <requirements>
        <container type="docker">proto2.norgene.no/proto2-test:latest</container>
    </requirements>
    <entry_points>
        <entry_point name="ProTo2 Interactive Tool" requires_domain="False">
            <port>5000</port>
        </entry_point>
        <entry_point name="ProTo2 Interactive Tool" requires_domain="False">
            <port>4040</port>
            <tool_port>22</tool_port>
        </entry_point>
    </entry_points>
    <environment_variables>
        <environment_variable name="HISTORY_ID">$__history_id__</environment_variable>
        <environment_variable name="USER_EMAIL">$__user_email__</environment_variable>
        <environment_variable name="REMOTE_HOST">$__galaxy_url__</environment_variable>
        <environment_variable name="GALAXY_URL">$__galaxy_url__</environment_variable>
        <environment_variable name="API_KEY" inject="api_key" />
    </environment_variables>
    <command detect_errors="exit_code"><![CDATA[
    	export GALAXY_WORKING_DIR=`pwd` &&
    	export GALAXY_OUTPUT='$output' &&

        #if $input:
              cp '$input' rerun.json &&
        #end if

        #if $ssh_key:
            SSH_DIR=/home/alpine/.ssh &&
            echo "Port 2222" >> /etc/ssh/sshd_config &&
            echo "PermitRootLogin No" >> /etc/ssh/sshd_config &&
            ssh-keygen -A &&
            mkdir $SSH_DIR
            echo $ssh_key > $SSH_DIR/authorized_keys &&
            chown -R alpine:alpine $SSH_DIR &&
            chmod -R g-rwx,o-rwx $SSH_DIR &&
            exec /usr/sbin/sshd &&
        #end if

        /bin/entrypoint.sh /bin/syncthing -home /var/syncthing/config &&
        /bin/entrypoint.sh env LOG="$GALAXY_OUTPUT" conda run -n proto2 /opt/proto/run.sh &&
    ]]>
    </command>
    <inputs>
        <param name="input" type="data" optional="true" label="xxx"/>
        <param name="ssh_key" type="data" optional="true" label="Public ssh key for direct connect"/>

    </inputs>
    <outputs>
        <data name="output" format="txt" label="ProTo2 service">
        	<discover_datasets pattern="__designation_and_ext__" directory="files" visible="true" />
        </data>
    </outputs>
    <tests>
    </tests>
    <help>
    </help>
</tool>
